window.TrNumberFormat=function(b,c,a){b||alert("type for TrNumberFormat not defined!");this._type=b;this._localeSymbols=getLocaleSymbols(c);a||(a={});TrNumberFormat.CURRENCY_CODE="currencyCode";TrNumberFormat.CURRENCY_SYMBOL="currencySymbol";TrNumberFormat.NEGATIVE_PREFIX="negativePrefix";TrNumberFormat.NEGATIVE_SUFFIX="negativeSuffix";TrNumberFormat.IS_GROUPING_USED="isGroupingUsed";TrNumberFormat.MAX_FRACTION_DIGITS="maxFractionDigits";TrNumberFormat.MAX_INTEGER_DIGITS="maxIntegerDigits";TrNumberFormat.MIN_FRACTION_DIGITS=
"minFractionDigits";TrNumberFormat.MIN_INTEGER_DIGITS="minIntegerDigits";TrNumberFormat.ROUNDING_MODE="roundingMode";var e=(b=null!=a[TrNumberFormat.MAX_INTEGER_DIGITS])?a[TrNumberFormat.MAX_INTEGER_DIGITS]:40,d=null!=a[TrNumberFormat.MAX_FRACTION_DIGITS],g=d?a[TrNumberFormat.MAX_FRACTION_DIGITS]:3,h=null!=a[TrNumberFormat.MIN_FRACTION_DIGITS],k=h?a[TrNumberFormat.MIN_FRACTION_DIGITS]:0,m=null!=a[TrNumberFormat.MIN_INTEGER_DIGITS],n=m?a[TrNumberFormat.MIN_INTEGER_DIGITS]:1,t=null!=a[TrNumberFormat.IS_GROUPING_USED],
u=t?a[TrNumberFormat.IS_GROUPING_USED]:!0,v=null!=a[TrNumberFormat.ROUNDING_MODE];"currency"==this._type?d||h?h||(k=2):(g=this._localeSymbols.getCurrencyMaximumFractionDigits(),k=this._localeSymbols.getCurrencyMinimumFractionDigits(),-1==g&&(g=2),-1==k&&(k=0)):"percent"==this._type&&(b||(e=this._localeSymbols.getPercentMaximumIntegerDigits()),d||(g=this._localeSymbols.getPercentMaximumFractionDigits()),h||(k=this._localeSymbols.getPercentMinimumFractionDigits()),m||(n=this._localeSymbols.getPercentMinimumIntegerDigits()));
d&&!h?k=Math.min(g,k):!d&&h&&(g=Math.max(g,k));b||(this._maxIntegerDigits=e);d||(this._maxFractionDigits=g);h||(this._minFractionDigits=k);m||(this._minIntegerDigits=n);t||(this._groupingUsed=u);v||(this._roundingMode=null);b&&this.setMaximumIntegerDigits(e);d&&this.setMaximumFractionDigits(g);h&&this.setMinimumFractionDigits(k);m&&this.setMinimumIntegerDigits(n);t&&this.setGroupingUsed(u);v&&this.setRoundingMode(null);this._updateLocaleAndSymbols(c,a)};
TrNumberFormat.getRoundedValue=function(b,c,a){if(null==a)return c;c=parseFloat(c);if(isNaN(c))return c;switch(b){case "UP":return c;case "DOWN":return c;case "CEILING":return c;case "FLOOR":return c;case "HALF_DOWN":return c;case "HALF_EVEN":return c;case "UNNECESSARY":return c;default:return c.toFixed(a)}};TrNumberFormat.getNumberInstance=function(b,c){return new TrNumberFormat("number",b,c)};TrNumberFormat.getCurrencyInstance=function(b,c){return new TrNumberFormat("currency",b,c)};
TrNumberFormat.getPercentInstance=function(b,c){return new TrNumberFormat("percent",b,c)};TrNumberFormat.prototype.setGroupingUsed=function(b){this._groupingUsed=b};TrNumberFormat.prototype.isGroupingUsed=function(){return this._groupingUsed};TrNumberFormat.prototype.setRoundingMode=function(b){this._roundingMode=b};TrNumberFormat.prototype.getRoundingMode=function(){return this._roundingMode};TrNumberFormat.prototype.isRoundingModeSpecified=function(){return null!=this.getRoundingMode()};
TrNumberFormat.prototype.setMaximumIntegerDigits=function(b){null!=b&&(this._maxIntegerDigits=0>b?0:b,this._minIntegerDigits>this._maxIntegerDigits&&(this._minIntegerDigits=this._maxIntegerDigits))};TrNumberFormat.prototype.getMaximumIntegerDigits=function(){return this._maxIntegerDigits};
TrNumberFormat.prototype.setMaximumFractionDigits=function(b){null!=b&&(this._maxFractionDigits=0>b?0:b,this._maxFractionDigits<this._minFractionDigits&&(this._minFractionDigits=this._maxFractionDigits),this._isMaxFractionDigitsSet=!0)};TrNumberFormat.prototype.getMaximumFractionDigits=function(){return this._maxFractionDigits};
TrNumberFormat.prototype.setMinimumIntegerDigits=function(b){null!=b&&(this._minIntegerDigits=0>b?0:b,this._minIntegerDigits>this._maxIntegerDigits&&(this._maxIntegerDigits=this._minIntegerDigits))};TrNumberFormat.prototype.getMinimumIntegerDigits=function(){return this._minIntegerDigits};TrNumberFormat.prototype.setMinimumFractionDigits=function(b){null!=b&&(this._minFractionDigits=0>b?0:b,this._maxFractionDigits<this._minFractionDigits&&(this._maxFractionDigits=this._minFractionDigits))};
TrNumberFormat.prototype.getMinimumFractionDigits=function(){return this._minFractionDigits};TrNumberFormat.prototype.format=function(b){if("percent"==this._type)return this.percentageToString(b);if("currency"==this._type)return this.currencyToString(b);if("number"==this._type)return this.numberToString(b)};TrNumberFormat.prototype.parse=function(b){return"percent"==this._type?this.stringToPercentage(b):"currency"==this._type?this.stringToCurrency(b):this.stringToNumber(b)};
TrNumberFormat.prototype.stringToNumber=function(b){var c=1;if(this.hasPrefixOrSuffix(b)){var a=this.removePrefixAndSuffix(b);b=a[0];a[1]||(c=-1)}if(isNaN(b)||-1!=b.indexOf("e")||-1!=b.indexOf("E"))throw new TrParseException("not able to parse number");return parseFloat(b)*c};
TrNumberFormat.prototype.hasPrefixOrSuffix=function(b){var c=b.indexOf(this._nPrefix),a=this._nSuffix;!a||" "!=a.charAt(0)&&"\u00a0"!=a.charAt(0)||(a=a.substring(1));a=b.indexOf(""==a?null:a);if(0==c||-1!=a)return!0;c=b.indexOf(this._pPrefix);a=this._pSuffix;!a||" "!=a.charAt(0)&&"\u00a0"!=a.charAt(0)||(a=a.substring(1));b=b.indexOf(""==a?null:a);return 0==c||-1!=b?!0:!1};TrNumberFormat.prototype.stringToCurrency=function(b){return this.stringToNumber(b)};
TrNumberFormat.prototype.removePrefixAndSuffix=function(b){var c=[],a=b.indexOf(this._nPrefix),e=this._nSuffix;!e||" "!=e.charAt(0)&&"\u00a0"!=e.charAt(0)||(e=e.substring(1));var d=b.indexOf(e);if(-1!=a&&-1!=d)return c.push(b.substr(this._nPrefix.length,b.length-(this._nPrefix.length+e.length))),c.push(!1),c;a=b.indexOf(this._pPrefix);e=this._pSuffix;!e||" "!=e.charAt(0)&&"\u00a0"!=e.charAt(0)||(e=e.substring(1));d=b.indexOf(e);if(-1!=a&&-1!=d)return c.push(b.substr(this._pPrefix.length,b.length-
(this._pPrefix.length+e.length))),c.push(!0),c;throw new TrParseException("not able to parse number");};TrNumberFormat.prototype.stringToPercentage=function(b){var c=this._localeSymbols.getPercentSuffix().trim();c||(c=this._localeSymbols.getPercentPositivePrefix().trim());if(-1==b.indexOf(c))throw new TrParseException("not able to parse number");b=b.replace(new RegExp(c,"g"),"");return this.stringToNumber(b)};
TrNumberFormat.prototype.numberToString=function(b,c,a){var e=0>b;e&&(b*=-1);var d;d=TrNumberFormat.scientificToExpanded(b+"");var g=d.indexOf("."),h=d.length;-1!=g?(b=d.substring(0,g),d=d.substring(g+1,h)):(b=d,d="");g=this._formatFractions(d);d=g.fracs;g.needToAdd1&&(b=parseInt(b,10),b=""+ ++b);b=this._formatIntegers(b);g=this._localeSymbols.getDecimalSeparator();d=""!=d?b+g+d:b;c?d+=c:a&&(d=a+d);if(e)d=this._nPrefix||this._nSuffix?this.addPrefixAndSuffix(d,!1):"-"+d;else if(this._pPrefix||this._pSuffix)d=
this.addPrefixAndSuffix(d,!0);return d};TrNumberFormat.prototype.addPrefixAndSuffix=function(b,c){return c?(this._pPrefix?this._pPrefix:"")+b+(this._pSuffix?this._pSuffix:""):(this._nPrefix?this._nPrefix:"")+b+(this._nSuffix?this._nSuffix:"")};TrNumberFormat.prototype.currencyToString=function(b){return this.numberToString(b)};
TrNumberFormat.prototype.percentageToString=function(b){b=this.moveDecimalRight(b);if(isNaN(b))throw new TrParseException("not able to parse number");var c=this._localeSymbols.getPercentSuffix(),a=this._localeSymbols.getPercentPositivePrefix();if(!(c&&""!=c||a&&""!=a))throw new TrParseException("suffix AND prefix are undefined, require at least one to be not null");return this.numberToString(b,c,a)};
TrNumberFormat.scientificToExpanded=function(b){var c=b.indexOf("e");if(-1==c)return b;var a="";"-"==b.charAt(0)&&(a="-",b=b.substring(1),--c);var e="+"==b.charAt(c+1),d=parseInt(b.substring(c+2)),g=c-2,h="";if(e){for(e=0;e<d-g;++e)h+="0";return a+b.charAt(0)+b.substring(2,c)+h}for(e=0;e<d-1;++e)h+="0";return a+"0."+h+b.charAt(0)+b.substring(2,c)};
TrNumberFormat.trimLeadingZeroes=function(b){var c=[],a,e;for(a=0;a<b.length;++a){e=b.charAt(a);if("1"<=e&&"9">=e||"."==e)break;"0"==e&&a+1<b.length&&"."!=b.charAt(a+1)||c.push(e)}return c.join("")+b.substring(a)};TrNumberFormat.prototype.getRounded=function(b){b=this.moveDecimalRight(b);b=Math.round(b);return b=this.moveDecimalLeft(b)};TrNumberFormat.prototype.moveDecimalRight=function(b){var c="";return c=this.moveDecimal(b,!1)};
TrNumberFormat.prototype.moveDecimalLeft=function(b){var c="";return c=this.moveDecimal(b,!0)};TrNumberFormat.prototype.moveDecimal=function(b,c){var a="",a=this.moveDecimalAsString(b,c);return parseFloat(a)};
TrNumberFormat.prototype.moveDecimalAsString=function(b,c){var a=b+"",e=this.getZeros(2),d=/([0-9.]+)/;c?(a=a.replace(d,e+"$1"),e=/(-?)([0-9]*)([0-9]{2})(\.?)/,a=a.replace(e,"$1$2.$3")):(d=d.exec(a),null!=d&&(a=a.substring(0,d.index)+d[1]+e+a.substring(d.index+d[0].length)),e=/(-?)([0-9]*)(\.?)([0-9]{2})/,a=a.replace(e,"$1$2$4."));return a=a.replace(/\.$/,"")};TrNumberFormat.prototype.getZeros=function(b){var c="",a;for(a=0;a<b;a++)c+="0";return c};
TrNumberFormat.prototype._updateLocaleAndSymbols=function(b,c){var a=c?c[TrNumberFormat.CURRENCY_CODE]:null,e=c?c[TrNumberFormat.CURRENCY_SYMBOL]:null,d=c?c[TrNumberFormat.NEGATIVE_PREFIX]:null,g=c?c[TrNumberFormat.NEGATIVE_SUFFIX]:null;this._localeSymbols=getLocaleSymbols(b);if("percent"==this._type||"number"==this._type)this._nPrefix=d?d:null,this._nSuffix=g?g:null,this._pSuffix=this._pPrefix=null;else{this._pPrefix=this._localeSymbols.getPositivePrefix();this._pSuffix=this._localeSymbols.getPositiveSuffix();
var h=this._localeSymbols.getNegativePrefix(),k=this._localeSymbols.getNegativeSuffix(),m=this._localeSymbols.getCurrencySymbol();this._nPrefix=this._replaceFormattingPrefixAndSuffix(h,m,d,!0);this._nSuffix=this._replaceFormattingPrefixAndSuffix(k,m,g,!1);a?this._localeSymbols.getCurrencyCode()!=a&&this._replaceCurrencyPrefixAndSuffix(m,a):e&&this._replaceCurrencyPrefixAndSuffix(m,e)}};
TrNumberFormat.prototype._replaceCurrencyPrefixAndSuffix=function(b,c){this._pPrefix=this._pPrefix.replace(b,c);this._pSuffix=this._pSuffix.replace(b,c);this._nPrefix=this._nPrefix.replace(b,c);this._nSuffix=this._nSuffix.replace(b,c)};
TrNumberFormat.prototype._replaceFormattingPrefixAndSuffix=function(b,c,a,e){var d=b;a&&(d=b.trim().indexOf(c),-1==d?d=a:b.trim()==c?d=e?a+b:b+a:0==d?(d=b.indexOf(c),d=b.substring(0,d)+(c+a)):(e=c.length,b.trim().length==e+d?(d=b.indexOf(c),d=a+c+b.substring(d+e,b.length)):d=a+c));return d};
TrNumberFormat.prototype._formatIntegers=function(b){var c=b.length,a=this.getMaximumIntegerDigits(),e=this.getMinimumIntegerDigits();if(c>a)b=b.substring(c-a,c);else if(c<e){c=e-c;for(a="";0<c;)a="0"+a,--c;b=a+b}this.isGroupingUsed()&&(b=this._addGroupingSeparators(b));return b};
TrNumberFormat.prototype._formatFractions=function(b){var c=b.length,a=this.getMaximumFractionDigits(),e=this.getMinimumFractionDigits(),d=!1;c>a&&a>=e&&(a=this.isRoundingModeSpecified()?c:a,b=TrNumberFormat.getRoundedValue(this._roundingMode,parseFloat("0."+b),a),isNaN(b)?b="":(1<=b&&(d=!0),b=b.substring(2)));if(c<e)for(c=e-c;0<c;)b+="0",--c;return{fracs:b,needToAdd1:d}};
TrNumberFormat.prototype._addGroupingSeparators=function(b){var c=b.length,a=c%3,e,d="",g=this._localeSymbols.getGroupingSeparator();0<a?(e=4>c?b.substring(0,a):b.substring(0,a)+g,b=b.substring(a,c)):e="";for(i=0;i<b.length;i++)0==i%3&&0!=i&&(d+=g),d+=b.charAt(i);return e+d};window.TrParseException=function(b){this._message=b};TrParseException.prototype.getMessage=function(){return this._message};